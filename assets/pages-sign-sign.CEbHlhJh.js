import{q as t,v as i,o as s,c as e,w as a,b as o,g as l,j as h,F as n,i as r,u as c,m as d,x as u,y as f,z as p,A as x,s as m,B as y,C as g,D as v,p as C,E as b,G as w,d as k,H as W,J as F}from"./index-DVZmvFWZ.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";const L=S({components:{pickerColor:S({name:"picker-color",props:{isShow:{type:Boolean,default:!1},bottom:{type:Number,default:0}},data:()=>({colorArr:[["#000000","#111111","#222222","#333333","#444444","#666666","#999999","#CCCCCC","#EEEEEE","#FFFFFF"],["#ff0000","#ff0033","#ff3399","#ff33cc","#cc00ff","#9900ff","#cc00cc","#cc0099","#cc3399","#cc0066"],["#cc3300","#cc6600","#ff9933","#ff9966","#ff9999","#ff99cc","#ff99ff","#cc66ff","#9966ff","#cc33ff"],["#663300","#996600","#996633","#cc9900","#a58800","#cccc00","#ffff66","#ffff99","#ffffcc","#ffcccc"],["#336600","#669900","#009900","#009933","#00cc00","#66ff66","#339933","#339966","#009999","#33cccc"],["#003366","#336699","#3366cc","#0099ff","#000099","#0000cc","#660066","#993366","#993333","#800000"]],pickerColor:"",pickerArr:[-1,-1]}),methods:{picker(t){let i=t.currentTarget.dataset;this.pickerColor=i.color,this.pickerArr=[i.index,i.i],this.$emit("callback",this.pickerColor)},hide(){this.$emit("callback","")}}},[["render",function(f,p,x,m,y,g){const v=r;return t((s(),e(v,null,{default:a((()=>[o(v,{class:"shade",onClick:g.hide},{default:a((()=>[o(v,{class:"pop"},{default:a((()=>[(s(!0),l(n,null,h(y.colorArr,((t,i)=>(s(),e(v,{class:"list flex_col",key:i},{default:a((()=>[(s(!0),l(n,null,h(t,((t,a)=>(s(),e(v,{key:a,style:c({backgroundColor:t}),"data-color":t,"data-index":i,"data-i":a,class:d({active:i==y.pickerArr[0]&&a==y.pickerArr[1]}),onClick:u(g.picker,["stop"])},null,8,["style","data-color","data-index","data-i","class","onClick"])))),128))])),_:2},1024)))),128))])),_:1})])),_:1},8,["onClick"])])),_:1},512)),[[i,x.isShow]])}],["__scopeId","data-v-02166a7e"]])},data:()=>({showPickerColor:!1,ctx:"",canvasWidth:0,canvasHeight:0,selectColor:"black",lineColor:"#1A1A1A",points:[],historyList:[],canAddHistory:!0,getImagePath:()=>new Promise((t=>{f({canvasId:"handWriting",fileType:"png",quality:1,success:i=>t(i.tempFilePath)})})),toDataURL:void 0,requestAnimationFrame:void 0}),props:{minSpeed:{type:Number,default:1.5},minWidth:{type:Number,default:3},maxWidth:{type:Number,default:10},openSmooth:{type:Boolean,default:!0},maxHistoryLength:{type:Number,default:20},maxWidthDiffRate:{type:Number,default:20},bgColor:{type:String,default:""}},onLoad(t){console.log(t),this.ctx=p("handWriting"),this.$nextTick((()=>{x().select(".handCenter").boundingClientRect((t=>{this.canvasWidth=t.width,this.canvasHeight=t.height,this.drawBgColor()})).exec()}))},onShow(){},methods:{getPickerColor(t){this.showPickerColor=!1,t&&(this.lineColor=t)},uploadScaleStart(t){this.canAddHistory=!0,this.ctx.setStrokeStyle(this.lineColor),this.ctx.setLineCap("round")},uploadScaleMove(t){let i=t.changedTouches[0].x,s=t.changedTouches[0].y;this.initPoint(i,s),this.onDraw()},uploadScaleEnd(){this.canAddHistory=!0,this.points=[]},initPoint(t,i){var s={x:t,y:i,t:Date.now()},e=this.points.slice(-1)[0];if(!e||e.t!==s.t&&(e.x!==t||e.y!==i)){if(e&&this.openSmooth){var a=this.points.slice(-2,-1)[0];if(s.distance=Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2)),s.speed=s.distance/(s.t-e.t||.1),s.lineWidth=this.getLineWidth(s.speed),a&&a.lineWidth&&e.lineWidth){var o=(s.lineWidth-e.lineWidth)/e.lineWidth,l=this.maxWidthDiffRate/100;if(l=l>1?1:l<.01?.01:l,Math.abs(o)>l){var h=o>0?l:-l;s.lineWidth=e.lineWidth*(1+h)}}}this.points.push(s),this.points=this.points.slice(-3)}},getLineWidth(t){var i=this.minSpeed>10?10:this.minSpeed<1?1:this.minSpeed,s=(this.maxWidth-this.minWidth)*t/i,e=Math.max(this.maxWidth-s,this.minWidth);return Math.min(e,this.maxWidth)},onDraw(){if(this.points.length<2)return;this.addHistory();var t=this.points.slice(-1)[0],i=this.points.slice(-2,-1)[0];let s=this;var e=function(){s.openSmooth?s.drawSmoothLine(i,t):s.drawNoSmoothLine(i,t)};"function"==typeof this.requestAnimationFrame?this.requestAnimationFrame((function(){return e()})):e()},addHistory(){if(!this.maxHistoryLength||!this.canAddHistory)return;if(this.canAddHistory=!1,!this.getImagePath)return void this.historyList.length++;let t=this;t.getImagePath().then((function(i){i&&(t.historyList.push(i),t.historyList=t.historyList.slice(-t.maxHistoryLength))}))},drawSmoothLine(t,i){var s=i.x-t.x,e=i.y-t.y;if(Math.abs(s)+Math.abs(e)<=2?(i.lastX1=i.lastX2=t.x+.5*s,i.lastY1=i.lastY2=t.y+.5*e):(i.lastX1=t.x+.3*s,i.lastY1=t.y+.3*e,i.lastX2=t.x+.7*s,i.lastY2=t.y+.7*e),i.perLineWidth=(t.lineWidth+i.lineWidth)/2,"number"==typeof t.lastX1){if(this.drawCurveLine(t.lastX2,t.lastY2,t.x,t.y,i.lastX1,i.lastY1,i.perLineWidth),t.isFirstPoint)return;if(t.lastX1===t.lastX2&&t.lastY1===t.lastY2)return;var a=this.getRadianData(t.lastX1,t.lastY1,t.lastX2,t.lastY2),o=this.getRadianPoints(a,t.lastX1,t.lastY1,t.perLineWidth/2),l=this.getRadianPoints(a,t.lastX2,t.lastY2,i.perLineWidth/2);this.drawTrapezoid(o[0],l[0],l[1],o[1])}else i.isFirstPoint=!0},drawNoSmoothLine(t,i){i.lastX=t.x+.5*(i.x-t.x),i.lastY=t.y+.5*(i.y-t.y),"number"==typeof t.lastX&&this.drawCurveLine(t.lastX,t.lastY,t.x,t.y,i.lastX,i.lastY,this.maxWidth)},drawCurveLine(t,i,s,e,a,o,l){l=Number(l.toFixed(1)),this.ctx.setLineWidth&&this.ctx.setLineWidth(l),this.ctx.lineWidth=l,this.ctx.beginPath(),this.ctx.moveTo(Number(t.toFixed(1)),Number(i.toFixed(1))),this.ctx.quadraticCurveTo(Number(s.toFixed(1)),Number(e.toFixed(1)),Number(a.toFixed(1)),Number(o.toFixed(1))),this.ctx.stroke(),this.ctx.draw&&this.ctx.draw(!0)},drawTrapezoid(t,i,s,e){this.ctx.beginPath(),this.ctx.moveTo(Number(t.x.toFixed(1)),Number(t.y.toFixed(1))),this.ctx.lineTo(Number(i.x.toFixed(1)),Number(i.y.toFixed(1))),this.ctx.lineTo(Number(s.x.toFixed(1)),Number(s.y.toFixed(1))),this.ctx.lineTo(Number(e.x.toFixed(1)),Number(e.y.toFixed(1))),this.ctx.setFillStyle&&this.ctx.setFillStyle(this.lineColor),this.ctx.fillStyle=this.lineColor,this.ctx.fill(),this.ctx.draw&&this.ctx.draw(!0)},getRadianData(t,i,s,e){var a=s-t,o=e-i;if(0===a)return{val:0,pos:-1};if(0===o)return{val:0,pos:1};var l=Math.abs(Math.atan(o/a));return s>t&&e<i||s<t&&e>i?{val:l,pos:1}:{val:l,pos:-1}},getRadianPoints(t,i,s,e){if(0===t.val)return 1===t.pos?[{x:i,y:s+e},{x:i,y:s-e}]:[{y:s,x:i+e},{y:s,x:i-e}];var a=Math.sin(t.val)*e,o=Math.cos(t.val)*e;return 1===t.pos?[{x:i+a,y:s+o},{x:i-a,y:s-o}]:[{x:i+a,y:s-o},{x:i-a,y:s+o}]},drawBgColor(){this.bgColor&&(this.ctx.setFillStyle&&this.ctx.setFillStyle(this.bgColor),this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.draw&&this.ctx.draw(!0))},drawByImage(t){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight);try{this.ctx.drawImage(t,0,0,this.canvasWidth,this.canvasHeight),this.ctx.draw&&this.ctx.draw(!0)}catch(i){this.historyList.length=0}},clear(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.draw&&this.ctx.draw(),this.drawBgColor(),this.historyList.length=0},undo(){if(this.getImagePath&&this.historyList.length){var t=this.historyList.splice(-1)[0];this.drawByImage(t),0===this.historyList.length&&this.clear()}},isEmpty(){return 0===this.historyList.length},selectColorEvent(t,i){this.selectColor=t,this.lineColor=i,this.ctx.setStrokeStyle(this.lineColor)},subCanvas(){this.isEmpty()?m({title:"没有任何绘制内容哦",icon:"none"}):f({canvasId:"handWriting",fileType:"png",quality:1,success(t){y("signComplate",t.tempFilePath),g()}})},saveCanvasAsImg(){f({canvasId:"handWriting",fileType:"png",quality:1,success(t){v({filePath:t.tempFilePath,success(t){m({title:"已保存到相册",duration:2e3})}})}})},previewCanvasImg(){f({canvasId:"handWriting",fileType:"jpg",quality:1,success(t){C({urls:[t.tempFilePath]})}})}}},[["render",function(t,i,l,h,n,d){const u=W,f=r,p=F,x=b("pickerColor");return s(),e(f,null,{default:a((()=>[o(f,{class:"wrapper"},{default:a((()=>[o(f,{class:"handBtn"},{default:a((()=>[w("div",{class:"color_pic",style:c({background:n.lineColor}),onClick:i[0]||(i[0]=t=>n.showPickerColor=!0)},null,4),o(u,{onClick:d.clear,class:"delBtn"},{default:a((()=>[k("清空")])),_:1},8,["onClick"]),o(u,{onClick:d.undo,class:"undoBtn"},{default:a((()=>[k("撤销")])),_:1},8,["onClick"]),o(u,{onClick:d.subCanvas,class:"subBtn"},{default:a((()=>[k("完成")])),_:1},8,["onClick"])])),_:1}),o(f,{class:"handCenter"},{default:a((()=>[o(p,{class:"handWriting","disable-scroll":!0,onTouchstart:d.uploadScaleStart,onTouchmove:d.uploadScaleMove,onTouchend:d.uploadScaleEnd,"canvas-id":"handWriting"},null,8,["onTouchstart","onTouchmove","onTouchend"])])),_:1}),o(f,{class:"handRight"},{default:a((()=>[o(f,{class:"handTitle"},{default:a((()=>[k("请签名")])),_:1})])),_:1})])),_:1}),o(x,{isShow:n.showPickerColor,bottom:0,onCallback:d.getPickerColor},null,8,["isShow","onCallback"])])),_:1})}],["__scopeId","data-v-53ce4be7"]]);export{L as default};
